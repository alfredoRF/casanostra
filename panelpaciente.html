<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Panel Paciente</title>
    <link href="assets/vendor/fontawesome/css/fontawesome.min.css" rel="stylesheet">
    <link href="assets/vendor/fontawesome/css/solid.min.css" rel="stylesheet">
    <link href="assets/vendor/fontawesome/css/brands.min.css" rel="stylesheet">
    <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/vendor/datatables/datatables.min.css" rel="stylesheet">
    <link href="assets/css/master.css" rel="stylesheet">
</head>

<body>
    <div class="wrapper">
        <!-- sidebar navigation component -->
        <nav id="sidebar" class="active">
            <div class="sidebar-header">
                <img src="assets/img/bootstraper-logo.png" alt="bootraper logo" class="app-logo">
            </div>
            <ul class="list-unstyled components text-secondary">
                <li>
                    <a href="dashboard.html"><i class="fas fa-home"></i>Dashboard</a>
                </li>
                <li>
                    <a href="forms.html"><i class="fas fa-file-alt"></i>Forms</a>
                </li>
                <li>
                    <a href="tables.html"><i class="fas fa-table"></i>Tables</a>
                </li>
                <li>
                    <a href="charts.html"><i class="fas fa-chart-bar"></i>Charts</a>
                </li>
                <li>
                    <a href="icons.html"><i class="fas fa-icons"></i>Icons</a>
                </li>
                <li>
                    <a href="#uielementsmenu" data-bs-toggle="collapse" aria-expanded="false"
                        class="dropdown-toggle no-caret-down"><i class="fas fa-layer-group"></i>UI Elements</a>
                    <ul class="collapse list-unstyled" id="uielementsmenu">
                        <li>
                            <a href="ui-buttons.html"><i class="fas fa-angle-right"></i>Buttons</a>
                        </li>
                        <li>
                            <a href="ui-badges.html"><i class="fas fa-angle-right"></i>Badges</a>
                        </li>
                        <li>
                            <a href="ui-cards.html"><i class="fas fa-angle-right"></i>Cards</a>
                        </li>
                        <li>
                            <a href="ui-alerts.html"><i class="fas fa-angle-right"></i>Alerts</a>
                        </li>
                        <li>
                            <a href="ui-tabs.html"><i class="fas fa-angle-right"></i>Tabs</a>
                        </li>
                        <li>
                            <a href="ui-date-time-picker.html"><i class="fas fa-angle-right"></i>Date & Time Picker</a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a href="#authmenu" data-bs-toggle="collapse" aria-expanded="false"
                        class="dropdown-toggle no-caret-down"><i class="fas fa-user-shield"></i>Authentication</a>
                    <ul class="collapse list-unstyled" id="authmenu">
                        <li>
                            <a href="login.html"><i class="fas fa-lock"></i>Login</a>
                        </li>
                        <li>
                            <a href="signup.html"><i class="fas fa-user-plus"></i>Signup</a>
                        </li>
                        <li>
                            <a href="forgot-password.html"><i class="fas fa-user-lock"></i>Forgot password</a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a href="#pagesmenu" data-bs-toggle="collapse" aria-expanded="false"
                        class="dropdown-toggle no-caret-down"><i class="fas fa-copy"></i>Pages</a>
                    <ul class="collapse list-unstyled" id="pagesmenu">
                        <li>
                            <a href="blank.html"><i class="fas fa-file"></i>Blank page</a>
                        </li>
                        <li>
                            <a href="404.html"><i class="fas fa-info-circle"></i>404 Error page</a>
                        </li>
                        <li>
                            <a href="500.html"><i class="fas fa-info-circle"></i>500 Error page</a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a href="users.html"><i class="fas fa-user-friends"></i>Users</a>
                </li>
                <li>
                    <a href="settings.html"><i class="fas fa-cog"></i>Settings</a>
                </li>
            </ul>
        </nav>
        <!-- end of sidebar component -->
        <div id="body" class="active">
            <!-- navbar navigation component -->
            <nav class="navbar navbar-expand-lg navbar-white bg-white">
                <button type="button" id="sidebarCollapse" class="btn btn-light">
                    <i class="fas fa-bars"></i><span></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="nav navbar-nav ms-auto">
                        <li class="nav-item dropdown">
                            <div class="nav-dropdown">
                                <a href="#" id="nav1" class="nav-item nav-link dropdown-toggle text-secondary"
                                    data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="fas fa-link"></i> <span>Quick Links</span> <i style="font-size: .8em;"
                                        class="fas fa-caret-down"></i>
                                </a>
                                <div class="dropdown-menu dropdown-menu-end nav-link-menu" aria-labelledby="nav1">
                                    <ul class="nav-list">
                                        <li><a href="" class="dropdown-item"><i class="fas fa-list"></i> Access Logs</a>
                                        </li>
                                        <div class="dropdown-divider"></div>
                                        <li><a href="" class="dropdown-item"><i class="fas fa-database"></i> Back
                                                ups</a></li>
                                        <div class="dropdown-divider"></div>
                                        <li><a href="" class="dropdown-item"><i class="fas fa-cloud-download-alt"></i>
                                                Updates</a></li>
                                        <div class="dropdown-divider"></div>
                                        <li><a href="" class="dropdown-item"><i class="fas fa-user-shield"></i>
                                                Roles</a></li>
                                    </ul>
                                </div>
                            </div>
                        </li>
                        <li class="nav-item dropdown">
                            <div class="nav-dropdown">
                                <a href="#" id="nav2" class="nav-item nav-link dropdown-toggle text-secondary"
                                    data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="fas fa-user"></i> <span>John Doe</span> <i style="font-size: .8em;"
                                        class="fas fa-caret-down"></i>
                                </a>
                                <div class="dropdown-menu dropdown-menu-end nav-link-menu">
                                    <ul class="nav-list">
                                        <li><a href="" class="dropdown-item"><i class="fas fa-address-card"></i>
                                                Profile</a></li>
                                        <li><a href="" class="dropdown-item"><i class="fas fa-envelope"></i>
                                                Messages</a></li>
                                        <li><a href="" class="dropdown-item"><i class="fas fa-cog"></i> Settings</a>
                                        </li>
                                        <div class="dropdown-divider"></div>
                                        <li><a href="" class="dropdown-item"><i class="fas fa-sign-out-alt"></i>
                                                Logout</a></li>
                                    </ul>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </nav>
            <!-- end of navbar navigation -->
            <div class="content">
                <div class="container">
                    <div class="page-title">
                        <h3 id="nombrepaciente">Panel paciente
                            <a href="pacientes.html" class="btn btn-sm btn-outline-primary float-end"><i
                                    class="fas fa-angle-left"></i> Regresar</a>
                        </h3>
                    </div>
                    <div class="box box-primary">
                        <div class="box-body">
                            <ul class="nav nav-tabs" id="myTab" role="tablist">
                                <li class="nav-item">
                                    <a class="nav-link active" id="general-tab" data-bs-toggle="tab" href="#general"
                                        role="tab" aria-controls="general" aria-selected="true">Generales</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="medicacion-tab" data-bs-toggle="tab" href="#medicaion"
                                        role="tab" aria-controls="medicacion" aria-selected="false"
                                        onclick="getMedicacion();">Medicamentos</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="condiciones-tab" data-bs-toggle="tab" href="#condiciones"
                                        role="tab" aria-controls="condiciones" aria-selected="false"
                                        onclick="getCondicionesMedicas();">Condiciones</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="notas-tab" data-bs-toggle="tab" href="#notas" role="tab"
                                        aria-controls="notas" aria-selected="false" onclick="getNotas()">Notas</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="attributions-tab" data-bs-toggle="tab" href="#attributions"
                                        role="tab" aria-controls="attributions" aria-selected="false">Signos Vitales</a>
                                </li>
                            </ul>
                            <div class="tab-content" id="myTabContent">
                                <div class="tab-pane fade active show" id="general" role="tabpanel"
                                    aria-labelledby="general-tab">
                                    <form id="form-datospaciente" accept-charset="utf-8" onsubmit="return false;">
                                        <input type="hidden" name="formidpaciente" id="formidpaciente">
                                        <h5><strong>Datos personales</strong></h5>
                                        <div class="col-12">
                                            <div class="row g-2">
                                                <div class="mb-3 col-6">
                                                    <label for="nombre" class="form-label">Nombre Completo</label>
                                                    <input type="text" name="nombre" id="nombre" class="form-control"
                                                        required>
                                                </div>
                                                <div class="mb-3 col-3">
                                                    <label for="nacionalidad" class="form-label">Nacionalidad</label>
                                                    <input type="text" class="form-control" name="nacionalidad"
                                                        id="nacionalidad" required />
                                                </div>
                                                <div class="mb-3 col-3">
                                                    <label for="fechaingreso" class="form-label">Fecha ingreso</label>
                                                    <input type="date" class="form-control" name="fechaingreso"
                                                        id="fechaingreso" required />
                                                </div>
                                            </div>
                                            <div class="row g-2">
                                                <div class="mb-3 col-3">
                                                    <label for="genero" class="form-label">Sexo biologico</label>
                                                    <select class="form-control" name="genero" id="genero" required>
                                                        <option value="h">Hombre</option>
                                                        <option value="m">Mujer</option>
                                                    </select>
                                                </div>
                                                <div class="mb-3 col-3">
                                                    <label for="fecnac" class="form-label">Fecha Nacimiento</label>
                                                    <input type="date" class="form-control" name="fecnac" id="fecnac"
                                                        required>
                                                </div>
                                                <div class="mb-3 col-3">
                                                    <label for="peso" class="form-label">Peso</label>
                                                    <div class="input-group mb-3">
                                                        <input type="number" class="form-control" name="peso" id="peso"
                                                            required>
                                                        <span class="input-group-text">kg</span>
                                                    </div>
                                                </div>
                                                <div class="mb-3 col-3">
                                                    <label for="estatura" class="form-label">Estatura</label>
                                                    <div class="input-group mb-3">
                                                        <input type="number" class="form-control" name="estatura"
                                                            id="estatura" required>
                                                        <span class="input-group-text">cm</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <h5><strong>Datos responsable 1</strong></h5>
                                            <div class="row g-2">
                                                <div class="mb-3 col-8">
                                                    <label for="responsable1" class="form-label">Nombre</label>
                                                    <input type="text" class="form-control" name="responsable1"
                                                        id="responsable1" required />
                                                </div>
                                                <div class="mb-3 col-4">
                                                    <label for="telefono1" class="form-label">Telefono</label>
                                                    <input type="text" class="form-control" name="telefono1"
                                                        id="telefono1" required />
                                                </div>
                                            </div>
                                            <div class="row g-2">
                                                <div class="mb-3 col-6">
                                                    <label for="direccion1" class="form-label">Direccion</label>
                                                    <input type="text" class="form-control" name="direccion1"
                                                        id="direccion1" required />
                                                </div>
                                                <div class="mb-3 col-6">
                                                    <label for="email1" class="form-label">Email</label>
                                                    <input type="text" class="form-control" name="email1" id="email1"
                                                        required />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <h5><strong>Datos responsable 2</strong></h5>
                                            <div class="row g-2">
                                                <div class="mb-3 col-8">
                                                    <label for="responsable2" class="form-label">Nombre</label>
                                                    <input type="text" class="form-control" name="responsable2"
                                                        id="responsable2" />
                                                </div>
                                                <div class="mb-3 col-4">
                                                    <label for="telefono2" class="form-label">Telefono</label>
                                                    <input type="text" class="form-control" name="telefono2"
                                                        id="telefono2" />
                                                </div>
                                            </div>
                                            <div class="row g-2">
                                                <div class="mb-3 col-6">
                                                    <label for="direccion2" class="form-label">Direccion</label>
                                                    <input type="text" class="form-control" name="direccion2"
                                                        id="direccion2" />
                                                </div>
                                                <div class="mb-3 col-6">
                                                    <label for="email2" class="form-label">Email</label>
                                                    <input type="text" class="form-control" name="email2" id="email2" />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="mb-3 text-end">
                                            <button id="btn-guardarpaciente" class="btn btn-success" type="submit"><i
                                                    class="fas fa-check"></i> Guardar</button>
                                        </div>
                                    </form>
                                </div>
                                <div class="tab-pane fade" id="medicaion" role="tabpanel"
                                    aria-labelledby="medicaion-tab">
                                    <div class="col-md-12">
                                        <a href="" class="btn btn-sm btn-outline-primary float-end"
                                            data-bs-toggle="modal" data-bs-target="#medicacionmodal"><i
                                                class="fas fa-plus-circle"></i> Nuevo</a>
                                        <table width="100%" class="table table-hover" id="table-medicacion">
                                            <thead>
                                                <tr>
                                                    <th>Medicamento</th>
                                                    <th>Dosis (ML)</th>
                                                    <th>Frecuencia (HR)</th>
                                                    <th>Fecha de Terminacion</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody>

                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="modal fade" id="medicacionmodal" role="dialog" tabindex="-1">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <form id="form-medicacion" accept-charset="utf-8"
                                                    onsubmit="event.preventDefault();">
                                                    <div class="modal-header">
                                                        <h5 class="modal-title">Nuevo medicamento</h5>
                                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                            aria-label="Close"></button>
                                                    </div>
                                                    <div class="modal-body text-start">
                                                        <div class="mb-3">
                                                            <label for="medicamento" class="
                                                                form-label">Medicamento</label>
                                                            <input type="text" name="medicamento" id="medicamento"
                                                                class="form-control" list="listamedicamentos" required>
                                                            <datalist id="listamedicamentos">
                                                            </datalist>
                                                        </div>
                                                        <div class="row g-2">
                                                            <div class="mb-3 col-6">
                                                                <label for="inicio" class="form-label">Inico</label>
                                                                <input type="date" id="inicio" name="inicio"
                                                                    class="form-control" required />
                                                            </div>
                                                            <div class="mb-3 col-6">
                                                                <label for="termina" class="form-label">Termina</label>
                                                                <input type="date" id="termina" name="termina"
                                                                    class="form-control" required />
                                                            </div>
                                                        </div>
                                                        <div class="row g-2">
                                                            <div class=" mb-3 col-6">
                                                                <label for="dosis" class="form-label">Dosis</label>
                                                                <div class="input-group mb-3">
                                                                    <input type="number" id="dosis" name="dosis"
                                                                        class="form-control" required /><span
                                                                        class="input-group-text">ml</span>
                                                                </div>

                                                            </div>
                                                            <div class="mb-3 col-6">
                                                                <label for="frecuencia"
                                                                    class="form-label">Frecuencia</label>
                                                                <div class="input-group mb-3">
                                                                    <input type="number" id="frecuencia"
                                                                        name="frecuencia" class="form-control"
                                                                        required />
                                                                    <span class="input-group-text">hrs</span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="mb-3">
                                                            <label for="descripcion"
                                                                class="form-label">Descripcion</label>
                                                            <textarea rows="4" id="descripcion" name="descripcion"
                                                                class="form-control"></textarea>
                                                        </div>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button id="btn-guardarmedicacion" type="button"
                                                            class="btn btn-success">Aceptar</button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="condiciones" role="tabpanel"
                                    aria-labelledby="condiciones-tab">
                                    <div class="col-md-12">
                                        <a href="" class="btn btn-sm btn-outline-primary float-end"
                                            data-bs-toggle="modal" data-bs-target="#condicionesmodal"><i
                                                class="fas fa-plus-circle"></i> Nuevo</a>
                                        <table width="100%" class="table table-hover" id="table-condicionesmedicas">
                                            <thead>
                                                <tr>
                                                    <th>Fecha</th>
                                                    <th>Condicion</th>
                                                    <th>Detalles</th>
                                                    <th></th>
                                            </thead>
                                            <tbody>

                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="modal fade" id="condicionesmodal" role="dialog" tabindex="-1">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <form id="form-condicionmedica" accept-charset="utf-8"
                                                    onsubmit="event.preventDefault();">
                                                    <div class="modal-header">
                                                        <h5 class="modal-title">Nueva Condicion</h5>
                                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                            aria-label="Close"></button>
                                                    </div>
                                                    <div class="modal-body text-start">
                                                        <div class="mb-3">
                                                            <label for="titulo" class="form-label">Titulo</label>
                                                            <input type="text" name="titulo" id="titulo"
                                                                class="form-control" required>
                                                        </div>
                                                        <div class="mb-3">
                                                            <label for="descripcion"
                                                                class="form-label">Descripcion</label>
                                                            <textarea rows="4" id="descripcion" name="descripcion"
                                                                class="form-control" required></textarea>
                                                        </div>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button id="btn-guardarcondicion" type="button"
                                                            class="btn btn-success">Aceptar</button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="notas" role="tabpanel" aria-labelledby="notas-tab">
                                    <div class="col-md-12">
                                        <a href="" class="btn btn-sm btn-outline-primary float-end"
                                            data-bs-toggle="modal" data-bs-target="#notamodal"><i
                                                class="fas fa-plus-circle"></i> Nuevo</a>
                                        <table width="100%" class="table table-hover" id="table-notas">
                                            <thead>
                                                <tr>
                                                    <th>Fecha</th>
                                                    <th>Nota</th>
                                                    <th></th>
                                            </thead>
                                            <tbody>

                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="modal fade" id="notamodal" role="dialog" tabindex="-1">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <form id="form-nota" accept-charset="utf-8"
                                                    onsubmit="event.preventDefault();">
                                                    <div class="modal-header">
                                                        <h5 class="modal-title">Nueva Nota</h5>
                                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                            aria-label="Close"></button>
                                                    </div>
                                                    <div class="modal-body text-start">
                                                      
                                                        <div class="mb-3">
                                                            <label for="nota"
                                                                class="form-label">Nota</label>
                                                            <textarea rows="4" id="nota" name="nota"
                                                                class="form-control" required></textarea>
                                                        </div>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button id="btn-guardarNota" type="button"
                                                            class="btn btn-success">Aceptar</button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="attributions" role="tabpanel"
                                    aria-labelledby="attributions-tab">
                                    <h4 class="mb-0">Legal Notice</h4>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="assets/vendor/jquery/jquery.min.js"></script>
    <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/vendor/datatables/datatables.min.js"></script>
    <script src="assets/js/script.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script>
        function validarFormulario(form) {
            const required = [];
            Array.prototype.slice.call(form).forEach((elm) => {
                if (elm.hasAttribute('required')) {
                    if (elm.value == "") {
                        elm.classList.add("is-invalid");
                        required.push(false);
                    } else {
                        elm.classList.remove("is-invalid");
                        required.push(true);
                    }
                }
            });
            return required;
        }

        $(function () {
            console.log("Cargando panel-paciente");
            const idpaciente = getIdPaciente();
            getPaciente(idpaciente);

            $("#btn-guardarcondicion").on("click", function () {
                guardarCondicion();
            });
            $("#btn-guardarmedicacion").on("click", () => {
                guardarMedicacion();
            });
            $("#btn-guardarpaciente").on("click", function (evt) {
                //evt.preventDefault();
                guardarPaciente();
            });
            $("#btn-guardarNota").on("click", ()=>{
                guardarNota();
            });
        });

        function guardarPaciente() {
            const url = "http://control.lacasanostra.com.mx/dao/patient.php";
            let form = document.querySelector("#form-datospaciente");

            const required = validarFormulario(form);
            if (!required.includes(false)) {
                const formData = new FormData(form);
                formData.append('id', $("#formidpaciente").val());
                formData.append('action', '3');
                fetch(url, { method: "post", body: formData })
                    .then(function (response) {
                        return response.json();
                    }).then(function (myJson) {
                        swal({
                            title: "Guardado",
                            text: "La informacion del paciente fue guardada",
                            icon: "success",
                            buttons: {
                                cancel: false,
                                confirm: "Aceptar",
                            },
                        });
                        getPaciente($("#formidpaciente").val());
                        resetform("form-datospaciente");
                    });
            }

        }

        function getPaciente(id) {
            var url = "http://control.lacasanostra.com.mx/dao/patient.php";
            const formData = new FormData();
            formData.append('action', '4');
            formData.append('id', id);
            fetch(url, { method: "post", body: formData })
                .then(function (response) {
                    return response.json();
                })
                .then(function (myJson) {
                    console.log(myJson);
                    $("#formidpaciente").val(myJson.id);
                    $("#nombre").val(myJson.nombre);
                    $("#nacionalidad").val(myJson.nacionalidad);
                    $("#fechaingreso").val(myJson.fechaingreso);
                    $("#sexo").val(myJson.sexo);
                    $("#fecnac").val(myJson.fecnac);
                    $("#peso").val(myJson.peso);
                    $("#estatura").val(myJson.estatura);
                    $("#responsable1").val(myJson.responsable1);
                    $("#telefono1").val(myJson.telefono1);
                    $("#email1").val(myJson.email1);
                    $("#direccion1").val(myJson.direccion1);
                    $("#responsable2").val(myJson.responsable2);
                    $("#telefono2").val(myJson.telefono2);
                    $("#email2").val(myJson.email2);
                    $("#direccion2").val(myJson.direccion2);

                });
        }

        function guardarCondicion() {
            const url = "http://control.lacasanostra.com.mx/dao/patient.php";
            const form = document.querySelector("#form-condicionmedica");
            const required = validarFormulario(form);
            if (!required.includes(false)) {
                const formData = new FormData(form);
                let date = new Date();
                formData.append('fecha', date.toISOString().slice(0, 19).replace('T', ' '));
                formData.append('idpaciente', getIdPaciente());
                formData.append('action', '9');
                fetch(url, { method: "post", body: formData })
                    .then((response) => response.json())
                    .then((condicion) => {
                        resetform("form-condicionmedica");
                        $('#condicionesmodal').modal('hide');
                        getCondicionesMedicas();
                        swal({
                            title: 'Guardado',
                            text: 'La condicion fue guardada',
                            icon: 'success',
                            buttons: {
                                cancel: false,
                                conform: 'Aceptar'
                            }
                        });
                    });
            }

        }

        function getMedicacion() {
            let url = "http://control.lacasanostra.com.mx/dao/patient.php";
            const formData = new FormData();
            formData.append('paciente', getIdPaciente());
            formData.append('action', '6');
            fetch(url, { method: "post", body: formData })
                .then((response) => response.json())
                .then((medicaciones) => {
                    //console.log(myJson)
                    let table = $('#table-medicacion').DataTable();
                    table.destroy();
                    table = $('#table-medicacion').DataTable({
                        data: medicaciones,
                        columns: [
                            { data: "medicamento" },
                            { data: "dosis" },
                            { data: "frecuencia" },
                            { data: "termina" },
                            {
                                data: "id",
                                render: (data, type) => {
                                    const btnaeditar = `<a href='#' class='btn btn-outline-info btn-rounded' onclick='mostrarMedicacion(${data})'><i class='fa-solid fa-eye' style='font-size:1.5em;'></i></a>`;
                                    //return btnagregar+"&nbsp;"+btnsacar+"&nbsp;"+btnhistorico;
                                    return btnaeditar;
                                }
                            }
                        ],
                        responsive: true,
                        pageLength: 20,
                        lengthChange: false,
                        searching: true,
                        ordering: true
                    });
                });
        }

        function guardarMedicacion() {
            const url = "http://control.lacasanostra.com.mx/dao/patient.php";
            const form = document.querySelector("#form-medicacion");
            const required = validarFormulario(form);
            if (!required.includes(false)) {
                const formData = new FormData(form);
                let date = new Date();
                formData.append('fecha', date.toISOString().slice(0, 19).replace('T', ' '));
                formData.append('paciente', getIdPaciente());
                formData.append('action', '5');
                fetch(url, { method: "post", body: formData })
                    .then((response) => response.json())
                    .then((medicacion) => {
                        resetform("form-medicacion");
                        $('#medicacionmodal').modal('hide');
                        getMedicacion();
                        swal({
                            title: 'Guardado',
                            text: 'La medicamento fue agregado',
                            icon: 'success',
                            buttons: {
                                cancel: false,
                                conform: 'Aceptar'
                            }
                        });
                    });
            }

        }

        function getCondicionesMedicas() {
            const url = "http://control.lacasanostra.com.mx/dao/patient.php";
            const formData = new FormData();
            formData.append('idpaciente', getIdPaciente());
            formData.append('action', '8');
            fetch(url, { method: "post", body: formData })
                .then(function (response) {
                    return response.json();
                })
                .then(function (myJson) {
                    console.log(myJson)
                    let table = $('#table-condicionesmedicas').DataTable();
                    table.destroy();
                    table = $('#table-condicionesmedicas').DataTable({
                        data: myJson,
                        columns: [
                            { data: "fecha" },
                            { data: "titulo" },
                            { data: "descripcion" },
                            {
                                data: "id",
                                render: function (data, type) {
                                    var btnaeditar = `<a href='#' class='btn btn-outline-info btn-rounded' onclick='getCondicion(${data})'><i class='fas fa-trash' style='font-size:1.5em;'></i></a>`;
                                    //return btnagregar+"&nbsp;"+btnsacar+"&nbsp;"+btnhistorico;
                                    return btnaeditar;
                                }
                            }
                        ],
                        responsive: true,
                        pageLength: 20,
                        lengthChange: false,
                        searching: true,
                        ordering: true
                    });
                });
        }

        function getNotas() {
            const url = "http://control.lacasanostra.com.mx/dao/patient.php";
            const formData = new FormData();
            formData.append('paciente', getIdPaciente());
            formData.append('action', '11');
            fetch(url, { method: "post", body: formData })
                .then((response) => response.json())
                .then((notas) => {
                    let table = $('#table-condicionesmedicas').DataTable();
                    table.destroy();
                    table = $('#table-condicionesmedicas').DataTable({
                        data: notas,
                        columns: [
                            { data: "fecha" },
                            { data: "nota" },
                            {
                                data: "id",
                                render: function (data, type) {
                                    var btnaeditar = `<a href='#' class='btn btn-outline-info btn-rounded' onclick='getNota(${data})'><i class='fas fa-trash' style='font-size:1.5em;'></i></a>`;
                                    //return btnagregar+"&nbsp;"+btnsacar+"&nbsp;"+btnhistorico;
                                    return btnaeditar;
                                }
                            }
                        ],
                        responsive: true,
                        pageLength: 20,
                        lengthChange: false,
                        searching: true,
                        ordering: true
                    });
                });
        }

        function guardarNota() {
            const url = "http://control.lacasanostra.com.mx/dao/patient.php";
            const form = document.querySelector("#form-nota");
            const required = validarFormulario(form);
            if (!required.includes(false)) {
                const formData = new FormData(form);
                let date = new Date();
                formData.append('fecha', date.toISOString().slice(0, 19).replace('T', ' '));
                formData.append('idpaciente', getIdPaciente());
                formData.append('action', '9');
                fetch(url, { method: "post", body: formData })
                    .then((response) => response.json())
                    .then((condicion) => {
                        resetform("form-condicionmedica");
                        $('#condicionesmodal').modal('hide');
                        getCondicionesMedicas();
                        swal({
                            title: 'Guardado',
                            text: 'La nota fue guardada',
                            icon: 'success',
                            buttons: {
                                cancel: false,
                                conform: 'Aceptar'
                            }
                        });
                    });
            }
        }

        function getIdPaciente() {
            const queryString = window.location.search;
            const urlParams = new URLSearchParams(queryString);
            var idpaciente = urlParams.get('paciente');
            console.log("regreando", idpaciente)
            return idpaciente;
        }

        function getTratamientoPaciente() {
            getListaMedicamentos();
        }

        function getListaMedicamentos() {
            var url = "http://control.lacasanostra.com.mx/dao/materialmedico.php";
            const formData = new FormData();
            formData.append('action', '1');
            fetch(url, { method: "post", body: formData })
                .then(function (response) {
                    return response.json();
                })
                .then(function (myJson) {
                    var items = "";
                    $.each(myJson, function (key, value) {
                        items += "<option value='" + value.nombre + "'>";
                    });
                    $("#listamedicamentos").html(items);
                });
        }

        function resetform(form) {
            $("#" + form)[0].reset();
        }
    </script>
</body>

</html>